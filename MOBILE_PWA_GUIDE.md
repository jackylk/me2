# Me2 移动端 PWA 使用指南

## 📱 什么是 PWA？

Progressive Web App（渐进式 Web 应用）可以让 Me2 像原生应用一样安装到你的手机主屏幕，提供：

- ✨ **离线访问**：没有网络也能打开应用
- ⚡ **更快加载**：智能缓存，启动更快
- 📲 **原生体验**：全屏显示，无浏览器地址栏
- 🔔 **推送通知**：（未来支持）接收主动关心消息
- 💾 **节省空间**：无需下载大型应用包

---

## 🚀 如何安装 Me2 到手机？

### iPhone / iPad (Safari)

1. **打开 Safari 浏览器**
   - 访问 Me2 网址（如 https://me2.app 或你的部署地址）

2. **点击分享按钮**
   - 位于底部中间的"分享"图标 📤

3. **添加到主屏幕**
   - 向下滚动菜单
   - 点击"添加到主屏幕"
   - 确认并点击"添加"

4. **完成！**
   - 主屏幕会出现 Me2 图标
   - 点击图标即可像原生应用一样使用

### Android (Chrome / Edge / Samsung Browser)

#### 方法 1：自动提示安装

1. **访问 Me2**
   - 使用 Chrome 或 Edge 浏览器
   - 访问 Me2 网址

2. **等待安装提示**
   - 第 3 次访问时会自动弹出安装提示
   - 或者底部会显示"安装 Me2 到主屏幕"横幅

3. **点击安装**
   - 点击提示中的"立即安装"按钮
   - 或点击浏览器的"安装"按钮

#### 方法 2：手动安装

1. **打开浏览器菜单**
   - Chrome: 点击右上角 ⋮ 菜单
   - Edge: 点击右下角 ··· 菜单

2. **选择安装选项**
   - 点击"添加到主屏幕"或"安装应用"
   - 确认安装

3. **完成！**
   - 主屏幕会出现 Me2 图标

---

## 🎯 使用技巧

### 1. 全屏体验

安装后的 Me2 会：
- 隐藏浏览器地址栏
- 显示状态栏（时间、电量等）
- 提供原生应用般的沉浸式体验

### 2. 离线功能

- **已缓存的页面**：可离线访问
- **新对话**：需要网络连接
- **记忆查看**：已加载的记忆可离线浏览
- **自动同步**：网络恢复后自动同步

### 3. 推送通知（未来支持）

未来版本将支持：
- 主动关心消息推送
- 重要提醒通知
- 可在系统设置中管理通知权限

### 4. 数据同步

- **自动保存**：对话实时保存到云端
- **多设备同步**：登录后可在多设备间同步
- **安全退出**：退出登录不会丢失数据

---

## 🔧 常见问题

### Q: 为什么看不到安装提示？

**A**: 可能的原因：
1. **浏览器不支持** - 请使用 Chrome、Edge 或 Safari
2. **已经安装** - 检查主屏幕是否已有 Me2 图标
3. **访问次数不够** - 需要访问 3 次以上
4. **使用隐私模式** - 请使用普通浏览模式

**解决方法**：
- 使用浏览器菜单手动添加到主屏幕
- 或联系管理员获取帮助

### Q: 安装后如何更新？

**A**: PWA 会自动更新：
- 每次打开应用时检查更新
- 后台自动下载新版本
- 下次启动时应用新版本
- 无需手动操作

### Q: 如何卸载 Me2？

**A**:
- **iPhone**: 长按图标 → 删除 App
- **Android**: 长按图标 → 卸载 或 应用信息 → 卸载

### Q: 占用多少存储空间？

**A**:
- **初始安装**: 约 5-10 MB
- **缓存数据**: 根据使用情况，通常 10-50 MB
- **总计**: 远小于原生应用（通常 < 100 MB）

### Q: 离线模式下能做什么？

**A**:
- ✅ 打开应用
- ✅ 查看已缓存的对话
- ✅ 浏览记忆列表
- ❌ 发送新消息（需要网络）
- ❌ 召回新记忆（需要网络）

---

## 🛠️ 开发者指南

### PWA 功能清单

已实现的功能：

- ✅ **Manifest.json** - 应用配置
- ✅ **Service Worker** - 离线支持和缓存
- ✅ **安装提示** - 智能安装引导
- ✅ **图标集** - 多尺寸应用图标
- ✅ **离线页面** - 网络断开时的友好提示
- ✅ **移动端优化** - 响应式布局和触摸优化
- ✅ **安全区域** - 刘海屏和底部手势条适配

未来计划：

- 🚧 **推送通知** - 主动关心消息
- 🚧 **后台同步** - 离线编辑的同步
- 🚧 **启动屏** - 自定义启动动画
- 🚧 **快捷方式** - 主屏幕快捷操作
- 🚧 **分享目标** - 接收其他应用分享

### 本地测试

1. **启动服务**
   ```bash
   cd frontend
   npm run dev
   ```

2. **手机访问**
   - 确保手机和电脑在同一网络
   - 访问 http://[电脑IP]:3000
   - 或使用内网穿透工具（ngrok、localtunnel）

3. **HTTPS 要求**
   - PWA 功能需要 HTTPS
   - 本地开发可使用 localhost
   - 生产环境必须使用 HTTPS

### 图标生成

```bash
# 生成 SVG 图标
cd frontend
node scripts/generate-icons.js

# 转换为 PNG（需要安装 sharp）
npm install -D sharp
node scripts/convert-icons.js  # 需要创建此脚本
```

### Service Worker 调试

**Chrome DevTools**:
1. 打开 DevTools (F12)
2. 切换到 Application 标签
3. 左侧选择 Service Workers
4. 查看注册状态、更新、卸载

**常用操作**:
- **强制更新**: 勾选 "Update on reload"
- **清除缓存**: Application → Clear storage
- **离线测试**: Network → Offline

---

## 📊 性能优化

### 缓存策略

**静态资源**（图标、样式、脚本）:
- 策略: 缓存优先（Cache First）
- 有效期: 长期缓存
- 更新: Service Worker 版本更新时清理

**API 请求**:
- 策略: 网络优先（Network First）
- 失败处理: 显示离线页面
- 不缓存: 确保数据实时性

**图片和媒体**:
- 策略: 缓存优先
- 大小限制: 单文件 < 10MB
- 总缓存: < 100MB

### 加载性能

- **首屏加载**: < 3 秒（3G 网络）
- **交互时间**: < 1 秒
- **缓存命中率**: > 80%

---

## 🔐 隐私和安全

### 数据存储

- **本地缓存**: 仅缓存已访问的内容
- **自动清理**: 超过限制时自动清理旧缓存
- **用户控制**: 可在浏览器中手动清除

### 权限

PWA 可能请求的权限：
- 📷 **相机** - 上传图片时
- 🔔 **通知** - 推送消息时（未来）
- 📍 **位置** - （暂不使用）

所有权限都需要用户明确授权。

---

## 📞 支持

遇到问题？

- 📧 提交 Issue: https://github.com/your-repo/issues
- 💬 社区讨论: https://discord.gg/your-server
- 📖 完整文档: https://docs.me2.app

---

**最后更新**: 2026-02-15
**版本**: v1.0
**维护者**: Me2 Team
