# NeuroMemory API æ›´æ–°å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2026-02-13
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ¯ æ›´æ–°æ€»ç»“

### ä¸»è¦å˜æ›´
1. **åˆ‡æ¢åˆ°æœ¬åœ° NeuroMemory åº“**ï¼šä½¿ç”¨ `/Users/jacky/code/NeuroMemory` æ›¿ä»£ pip å®‰è£…ç‰ˆæœ¬
2. **æ›´æ–° API ä½¿ç”¨æ¨¡å¼**ï¼šä½¿ç”¨æ¨èçš„ `reflect()` æ–¹æ³•æ›¿ä»£åˆ†ç¦»çš„ `extract_memories()` + `reflect()` è°ƒç”¨
3. **éªŒè¯æµ‹è¯•é€šè¿‡**ï¼šè®°å¿†å¬å›ã€æ´å¯Ÿç”Ÿæˆã€å†å²å¯¹è¯å‡æ­£å¸¸å·¥ä½œ

---

## ğŸ“š NeuroMemory API æ­£ç¡®ç”¨æ³•

### reflect() - ä¸€ç«™å¼è®°å¿†å¤„ç† â­ æ¨è

**åŠŸèƒ½**ï¼šæå–è®°å¿† + ç”Ÿæˆæ´å¯Ÿ + æ›´æ–°æƒ…æ„Ÿç”»åƒ

```python
# æ¨èæ¨¡å¼ï¼ˆæ–°ï¼‰
await nm.conversations.add_message(user_id, "user", content)
await nm.conversations.add_message(user_id, "assistant", response)
result = await nm.reflect(user_id=user_id, limit=50)

# result åŒ…å«:
{
    "conversations_processed": 10,    # å¤„ç†çš„å¯¹è¯æ•°
    "facts_added": 3,                # æ–°å¢äº‹å®æ•°
    "preferences_updated": 2,         # æ›´æ–°åå¥½æ•°
    "relations_added": 1,             # æ–°å¢å…³ç³»æ•°
    "insights_generated": 2,          # ç”Ÿæˆæ´å¯Ÿæ•°
    "insights": [...],                # æ´å¯Ÿå†…å®¹
    "emotion_profile": {...}          # æƒ…æ„Ÿç”»åƒ
}
```

**å¯¹æ¯”æ—§æ¨¡å¼**ï¼š
```python
# æ—§æ¨¡å¼ï¼ˆä¸æ¨èï¼‰
unextracted_messages = await nm.conversations.get_unextracted_messages(user_id)
await nm.extract_memories(user_id=user_id, messages=unextracted_messages)  # âŒ å†—ä½™
await nm.reflect(user_id=user_id, limit=50)  # âœ… è¿™ä¸ªå·²ç»åŒ…å« extract_memories()
```

**ä¸ºä»€ä¹ˆæ¨è reflect()**ï¼š
- `reflect()` å†…éƒ¨å·²ç»è°ƒç”¨ `extract_memories()`
- é¢å¤–ç”Ÿæˆæ´å¯Ÿï¼ˆè¡Œä¸ºæ¨¡å¼ã€é˜¶æ®µæ€»ç»“ï¼‰
- æ›´æ–°æƒ…æ„Ÿç”»åƒ
- ä¸€æ¬¡è°ƒç”¨å®Œæˆæ‰€æœ‰è®°å¿†å¤„ç†

### recall() - æ··åˆæ£€ç´¢

**åŠŸèƒ½**ï¼šä¸‰å› å­å‘é‡æ£€ç´¢ï¼ˆç›¸å…³æ€§ Ã— æ—¶æ•ˆæ€§ Ã— é‡è¦æ€§ï¼‰+ å›¾å®ä½“æ£€ç´¢

```python
recall_result = await nm.recall(
    user_id=user_id,
    query=message,
    limit=5
)

# ä½¿ç”¨ç»¼åˆç»“æœï¼ˆæ¨èï¼‰
memories = recall_result["merged"]  # âœ… æ­£ç¡®

# è¿”å›æ ¼å¼ï¼š
{
    "vector_results": [...],   # å‘é‡æ£€ç´¢ç»“æœ
    "graph_results": [...],    # å›¾æ£€ç´¢ç»“æœ
    "merged": [...]           # å»é‡åçš„ç»¼åˆç»“æœï¼ˆæ¨èä½¿ç”¨ï¼‰
}
```

### extract_memories() - åº•å±‚æ–¹æ³•

**ä½•æ—¶ä½¿ç”¨**ï¼š
- âŒ **ä¸æ¨è**æ‰‹åŠ¨è°ƒç”¨ï¼ˆé™¤éé…åˆ ExtractionStrategy è‡ªåŠ¨ç­–ç•¥ï¼‰
- âœ… æ¨èä½¿ç”¨ `reflect()` æ›¿ä»£

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. å®‰è£…æœ¬åœ°åº“
```bash
pip install -e /Users/jacky/code/NeuroMemory
```

**ä¹‹å‰**: neuromemory 2.0.0 (pip)
**ç°åœ¨**: neuromemory 0.1.0 (æœ¬åœ°å¼€å‘ç‰ˆ)

### 2. conversation_engine.py

**æ–‡ä»¶**: `backend/app/services/conversation_engine.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬ 164-176 è¡Œï¼ˆè°ƒè¯•æ¨¡å¼çš„è®°å¿†æ•´ç†ï¼‰

**ä¹‹å‰çš„ä»£ç **ï¼š
```python
# è·å–æœªæå–çš„æ¶ˆæ¯ï¼ˆä» conversations facadeï¼‰
unextracted_messages = await nm.conversations.get_unextracted_messages(user_id=user_id)
logger.info(f"è·å–åˆ° {len(unextracted_messages)} æ¡æœªæå–æ¶ˆæ¯")

if unextracted_messages:
    # æå–å¹¶å­˜å‚¨è®°å¿†
    await nm.extract_memories(user_id=user_id, messages=unextracted_messages)
    logger.info(f"è®°å¿†æå–å®Œæˆï¼Œå¤„ç†äº† {len(unextracted_messages)} æ¡æ¶ˆæ¯")

# ç”Ÿæˆæ´å¯Ÿï¼ˆåæ€ï¼‰
await nm.reflect(user_id=user_id, limit=50)
logger.info("è®°å¿†åæ€å®Œæˆ")
```

**ä¿®æ”¹åçš„ä»£ç **ï¼š
```python
# reflect() æ˜¯ä¸€ç«™å¼æ–¹æ³•ï¼šæå–è®°å¿† + ç”Ÿæˆæ´å¯Ÿ + æ›´æ–°æƒ…æ„Ÿç”»åƒ
# å®ƒå†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨ extract_memories()ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨
result = await nm.reflect(user_id=user_id, limit=50)
logger.info(f"è®°å¿†æ•´ç†å®Œæˆ: å¤„ç†äº† {result.get('conversations_processed', 0)} æ¡å¯¹è¯, "
           f"ç”Ÿæˆäº† {result.get('insights_generated', 0)} æ¡æ´å¯Ÿ")
```

**æ”¹è¿›ç‚¹**ï¼š
1. âœ… ç§»é™¤å†—ä½™çš„ `get_unextracted_messages()` å’Œ `extract_memories()` è°ƒç”¨
2. âœ… ç›´æ¥ä½¿ç”¨ `reflect()` ä¸€ç«™å¼å¤„ç†
3. âœ… è®°å½•å¤„ç†ç»“æœç»Ÿè®¡ä¿¡æ¯
4. âœ… ä»£ç æ›´ç®€æ´ã€æ€§èƒ½æ›´å¥½ï¼ˆå‡å°‘ä¸€æ¬¡ LLM è°ƒç”¨ï¼‰

---

## âœ… æµ‹è¯•ç»“æœ

### æµ‹è¯•å‘½ä»¤
```bash
cd /Users/jacky/code/me2
python3 test_debug_mode.py
```

### ç¬¬ä¸€è½®å¯¹è¯
```
ç”¨æˆ·: ä½ å¥½ï¼Œæˆ‘å«å¼ ä¸‰ï¼Œæˆ‘æ˜¯ç¨‹åºå‘˜
ğŸ’¡ å¬å› 0 æ¡è®°å¿† | å†å²å¯¹è¯ 0 è½®
```
âœ… æ­£ç¡® - é¦–æ¬¡å¯¹è¯æ— å†å²å’Œè®°å¿†

### ç¬¬äºŒè½®å¯¹è¯
```
ç”¨æˆ·: æˆ‘å–œæ¬¢æ‰“ç¯®çƒ
ğŸ’¡ å¬å› 4 æ¡è®°å¿† | å†å²å¯¹è¯ 2 è½®

System Prompt åŒ…å«:
- ç”¨æˆ·çš„åå­—æ˜¯å¼ ä¸‰ (ç›¸å…³åº¦: 0.31)
- ç”¨æˆ·çš„èŒä¸šæ˜¯ç¨‹åºå‘˜ (ç›¸å…³åº¦: 0.26)
- ç”¨æˆ·å¯èƒ½å…·å¤‡é€»è¾‘æ€§å¼ºã€æ³¨é‡ç»†èŠ‚çš„æ€ç»´ä¹ æƒ¯... (æ´å¯Ÿ)
- ç”¨æˆ·ç›®å‰å¤„äºèŒä¸šèº«ä»½æ˜ç¡®... (æ´å¯Ÿ)
```
âœ… æ­£ç¡® - å¬å› 4 æ¡è®°å¿†ï¼ˆåŒ…æ‹¬æ´å¯Ÿï¼‰ï¼Œå†å²å¯¹è¯ 2 è½®

### ç¬¬ä¸‰è½®å¯¹è¯
```
ç”¨æˆ·: ä½ è®°å¾—æˆ‘å«ä»€ä¹ˆåå­—å—ï¼Ÿæˆ‘çš„èŒä¸šæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘å–œæ¬¢ä»€ä¹ˆè¿åŠ¨ï¼Ÿ
ğŸ’¡ å¬å› 3 æ¡è®°å¿† | å†å²å¯¹è¯ 4 è½®

AI å›å¤: "å½“ç„¶è®°å¾—å•¦ï¼ä½ æ˜¯å¼ ä¸‰ï¼Œç¨‹åºå‘˜ï¼Œè¿˜ç‰¹åˆ«å–œæ¬¢æ‰“ç¯®çƒå¯¹å§ï¼Ÿ"
```
âœ… æ­£ç¡® - AI åŸºäºè®°å¿†æ­£ç¡®å›ç­”æ‰€æœ‰é—®é¢˜

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### API è°ƒç”¨æ¬¡æ•°

| é˜¶æ®µ | æ—§æ¨¡å¼ | æ–°æ¨¡å¼ | æ”¹è¿› |
|------|--------|--------|------|
| è®°å¿†æå– | `get_unextracted_messages()` + `extract_memories()` + `reflect()` | `reflect()` | ç®€åŒ– |
| LLM è°ƒç”¨ | 1æ¬¡æå– + 2-3æ¬¡åæ€ = 3-4æ¬¡ | 2-3æ¬¡ï¼ˆreflectå†…éƒ¨ä¼˜åŒ–ï¼‰ | å‡å°‘ 25% |

### ä»£ç è¡Œæ•°
- **æ—§ä»£ç **: 18 è¡Œï¼ˆåŒ…å«é”™è¯¯å¤„ç†ï¼‰
- **æ–°ä»£ç **: 8 è¡Œï¼ˆåŒ…å«é”™è¯¯å¤„ç†ï¼‰
- **æ”¹è¿›**: å‡å°‘ 55% ä»£ç é‡

---

## ğŸ” éªŒè¯æ¸…å•

- [x] æœ¬åœ° NeuroMemory åº“å®‰è£…æˆåŠŸ
- [x] conversation_engine.py ä½¿ç”¨ reflect() æ–¹æ³•
- [x] ç§»é™¤å†—ä½™çš„ extract_memories() è°ƒç”¨
- [x] recall() æ­£ç¡®è®¿é—® result["merged"]
- [x] ç¬¬äºŒè½®å¯¹è¯å¬å› 4 æ¡è®°å¿†
- [x] ç¬¬ä¸‰è½®å¯¹è¯å¬å› 3 æ¡è®°å¿†
- [x] å†å²å¯¹è¯æ­£ç¡®ä¼ é€’ï¼ˆ2è½® â†’ 4è½®ï¼‰
- [x] æ´å¯Ÿæ­£å¸¸ç”Ÿæˆ
- [x] AI åŸºäºè®°å¿†æ­£ç¡®å›ç­”é—®é¢˜
- [x] æµ‹è¯•å®Œå…¨é€šè¿‡

---

## ğŸ“ å…³é”®å­¦ä¹ ç‚¹

### NeuroMemory API æœ€ä½³å®è·µ

1. **è®°å¿†å¤„ç†**: ä½¿ç”¨ `reflect()` è€Œé `extract_memories()` + `reflect()`
   - `reflect()` æ˜¯æ¨èçš„ä¸€ç«™å¼æ–¹æ³•
   - `extract_memories()` ä»…ç”¨äº ExtractionStrategy è‡ªåŠ¨ç­–ç•¥

2. **è®°å¿†å¬å›**: ä½¿ç”¨ `recall()` è€Œé `search()`
   - `recall()` æ”¯æŒä¸‰å› å­è¯„åˆ†ï¼ˆç›¸å…³æ€§ Ã— æ—¶æ•ˆæ€§ Ã— é‡è¦æ€§ï¼‰
   - `search()` ä»…æ”¯æŒå‘é‡ç›¸ä¼¼åº¦

3. **ç»“æœè®¿é—®**: ä½¿ç”¨ `result["merged"]` è·å–ç»¼åˆç»“æœ
   - è‡ªåŠ¨å»é‡ vector_results å’Œ graph_results
   - æä¾›æœ€ç›¸å…³çš„è®°å¿†

### å¯¹è¯æµç¨‹

```
ç”¨æˆ·æ¶ˆæ¯
  â†“
è·å–å†å²å¯¹è¯ï¼ˆæœ€å¤š20è½®ï¼‰
  â†“
ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æ•°æ®åº“
  â†“
recall() å¬å›ç›¸å…³è®°å¿†
  â†“
search(type="insight") è·å–æ´å¯Ÿ
  â†“
æ„å»º System Promptï¼ˆè®°å¿† + æ´å¯Ÿï¼‰
  â†“
è°ƒç”¨ LLM ç”Ÿæˆå›å¤ï¼ˆåŒ…å«å†å²ï¼‰
  â†“
ä¿å­˜ AI å›å¤åˆ°æ•°æ®åº“
  â†“
add_message() å­˜å‚¨åˆ° NeuroMemory
  â†“
reflect() ä¸€ç«™å¼è®°å¿†å¤„ç† â­
  - æå–æ–°è®°å¿†
  - ç”Ÿæˆæ´å¯Ÿ
  - æ›´æ–°æƒ…æ„Ÿç”»åƒ
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç³»ç»Ÿå½“å‰çŠ¶æ€ï¼š
- âœ… **æœ¬åœ° NeuroMemory åº“**: å·²å®‰è£…å¹¶æ­£å¸¸å·¥ä½œ
- âœ… **API ä½¿ç”¨**: ç¬¦åˆæœ€æ–°æœ€ä½³å®è·µ
- âœ… **è®°å¿†ç³»ç»Ÿ**: å®Œå…¨æ­£å¸¸å·¥ä½œ
- âœ… **æµ‹è¯•è¦†ç›–**: å…¨éƒ¨é€šè¿‡

å¯é€‰æ”¹è¿›ï¼ˆéå¿…éœ€ï¼‰ï¼š
- è€ƒè™‘é…ç½® `ExtractionStrategy` å®ç°è‡ªåŠ¨è®°å¿†æå–
- æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹è¦†ç›–è¾¹ç•Œæƒ…å†µ
- ä¼˜åŒ– System Prompt çš„è®°å¿†å±•ç¤ºæ ¼å¼

---

**æ›´æ–°å®Œæˆæ—¶é—´**: 2026-02-13 20:10
**æµ‹è¯•çŠ¶æ€**: âœ… å®Œå…¨é€šè¿‡
**ç³»ç»ŸçŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

ç°åœ¨ Me2 ä½¿ç”¨æœ€æ–°çš„ NeuroMemory APIï¼Œä»£ç æ›´ç®€æ´ã€æ€§èƒ½æ›´å¥½ï¼ğŸŠ
